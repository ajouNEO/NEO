<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>게임 선택 폼</title>
<style>
    /* 로딩 창 스타일 */
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
</style>

<style>
    /* 업로드 영역 스타일 */
    #upload-area {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
    }
    /* 파일 목록 스타일 */
    #fileList {
        list-style-type: none;
        padding: 0;
    }
    /* 파일 아이템 스타일 */
    .file-item {
        margin-bottom: 5px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
    }
    .file-item:hover {
        background-color: #f0f0f0;
    }
</style>

</head>
<body>

    <form id="gameForm">
        <label for="game">게임 종류:</label>
        <select id="game">
            <option value="mc1.16.5">마인크래프트 1.16.5</option>
            <option value="mc1.19.2">마인크래프트 1.19.2</option>
            <option value="mc1.20.4">마인크래프트 1.20.4</option>
        </select>
        <br>
    
        <label for="ramCapacity">RAM 용량:</label>
        <select id="ramCapacity">
            <option value=2>2GB</option>
            <option value=4>4GB</option>
            <option value=8>8GB</option>
        </select>
        <br>
    
        <label for="paymentSystem">요금제:</label>
        <select id="paymentSystem">
            <option value="time">시간단위</option>
            <option value="day">일단위</option>
            <option value="month">월단위</option>
        </select>
        <br>
    
        <label for="time">시간:</label>
        <select id="time">
            <option value="1hour">1시간</option>
            <option value="2hours">2시간</option>
            <option value="3hours">3시간</option>
        </select>
        <br>
    
        <button type="button" onclick="submitForm()">생성</button>
    </form>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div>생성 중...</div>
    </div>

<script>
    function submitForm() {
        const game = document.getElementById('game').value;
        const ramCapacity = document.getElementById('ramCapacity').value;
        const paymentSystem = document.getElementById('paymentSystem').value;
        const time = document.getElementById('time').value;
    
        const formData = {
            game,
            ramCapacity,
            paymentSystem,
            time
        };
    
        // 로딩 창 보이기
        document.getElementById('loadingOverlay').style.display = 'flex';
    
        fetch('/api/container/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        })
        .then(response => {
            if (!response.ok) {
                // 오류 상태 코드를 처리합니다. 여기서는 에러를 throw 하지만, 다른 방식으로 처리할 수도 있습니다.
                throw new Error('Network response was not ok');
            }
            return response.json()
        })
        .then(data => {
            alert("생성 완료");
        })
        .catch((error) => {
            console.error('Error:', error);
            alert("생성 실패");
        })
        .finally(() => {
            // 로딩 창 숨기기
            document.getElementById('loadingOverlay').style.display = 'none';
        });
    }
</script>

<div id="userDockerList"></div>

    <h3>해당 폴더에 있는 폴더 및 파일 목록:</h3>
    <button id="goBackButton">뒤로 가기</button>
    <ul id="fileList"></ul>
    <h1>게임 서버 제어 API</h1>
    <h2>게임 서버 시작</h2>
    <p>게임 서버를 시작합니다.</p>
    <button onclick="startServer()">서버 시작</button>

    <h2>게임 서버 종료</h2>
    <p>게임 서버를 종료합니다.</p>
    <button onclick="stopServer()">서버 종료</button>

<script>

    // 페이지 로드 시 사용자 정보 가져오기
    document.addEventListener("DOMContentLoaded", function() {
        // getUserInfo();
        refreshFileList(``);
    });
    
    function refreshFileList(path) {
        fetch(`/api/docker-file-list?path=${path}`)
        .then(response => response.json())
        .then(data => {
            // console.log(data); // 받은 데이터를 콘솔에 출력
            const fileList = document.getElementById("fileList");
            fileList.innerHTML = "";
            data.forEach(item => {
                // console.log(item.name + (item.directory));
                // console.log(item);
                const listItem = document.createElement("li");
                const link = document.createElement("a");
                link.textContent = item.file + (item.isDirectory ? " (폴더)" : " (파일)");
                link.href = "#";
                link.addEventListener("click", () => {
                    if (item.isDirectory) {
                        previousPaths.push(item.file);
                        refreshFileList(`${path}/${item.file}`);
                    } else {
                        downloadFile(`${path}/${item.file}`);
                    }
                });
                listItem.appendChild(link);
                fileList.appendChild(listItem);
            });
        })
        .catch(error => {
            console.error("Error fetching file list:", error);
        });
    }

        // 이전 경로를 저장하는 변수
    let previousPath = "";

    // 이전 경로들을 저장하는 배열
    let previousPaths = [];

    // 뒤로 가기 버튼 클릭 시 이벤트 핸들러
    document.getElementById("goBackButton").addEventListener("click", () => {
        console.log(previousPaths);
        // 이전 경로가 있을 경우
        if (previousPaths.length > 0) {
            // 배열에서 마지막 이전 경로를 가져옴
            previousPaths.pop();
            const previousPath = previousPaths.join('/');
            // 이전 경로로 데이터를 요청
            console.log(previousPath);
            refreshFileList(previousPath);
        }
    });

    function downloadFile(filePath) {
        // 여기에 파일 다운로드 로직을 추가하세요.
        alert(`선택된 파일: ${filePath}`);
    }

    function startServer() {
        fetch('/api/server/start')
            .then(response => {
                if (!response.ok) {
                    throw new Error('서버 시작에 실패했습니다.');
                }
                return response.json();
            })
            .then(data => {
                console.log('서버 시작:', data);
                // 여기에서 필요한 처리를 수행하세요.
            })
            .catch(error => console.error('오류 발생:', error));
    }

    function stopServer() {
        fetch('/api/server/stop')
            .then(response => {
                if (!response.ok) {
                    throw new Error('서버 종료에 실패했습니다.');
                }
                return response.json();
            })
            .then(data => {
                console.log('서버 종료:', data);
                // 여기에서 필요한 처리를 수행하세요.
            })
            .catch(error => console.error('오류 발생:', error));
    }
</script>


</body>
</html>